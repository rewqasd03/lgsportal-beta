<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Basit Firebase Test</title>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .test-button {
            background: #007bff;
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px;
            font-size: 16px;
        }
        .test-button:hover {
            background: #0056b3;
        }
        .status {
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
        }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        .log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            white-space: pre-wrap;
            font-family: monospace;
            max-height: 400px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸ§ª Firebase BaÄŸlantÄ± Testi</h1>
        <p>Bu sayfa Firebase baÄŸlantÄ±nÄ±zÄ± test eder ve temizleme iÅŸlemini dener.</p>
        
        <button class="test-button" onclick="testFirebaseConnection()">ğŸ”Œ Firebase BaÄŸlantÄ±sÄ±nÄ± Test Et</button>
        <button class="test-button" onclick="testDataRead()">ğŸ“Š Veri Okuma Testi</button>
        <button class="test-button" onclick="testDelete()">ğŸ—‘ï¸ Test Silme Ä°ÅŸlemi</button>
        
        <div id="status" class="status" style="display: none;"></div>
        <div id="log" class="log"></div>
    </div>

    <script>
        // Firebase config
        const firebaseConfig = {
            apiKey: "AIzaSyBYfBhkLIfjqpnL9MxBhxW6iJeC0VAEDLk",
            authDomain: "kopruler-basari-portali.firebaseapp.com",
            projectId: "kopruler-basari-portali",
            storageBucket: "kopruler-basari-portali.firebasestorage.app",
            messagingSenderId: "318334276429",
            appId: "1:318334276429:web:7caa5e5b9dccb564d71d04",
            measurementId: "G-EF6P77SMFP"
        };

        // Firebase'i initialize et
        let app, db;
        try {
            app = firebase.initializeApp(firebaseConfig);
            db = firebase.firestore();
            console.log('âœ… Firebase baÅŸarÄ±yla initialize edildi');
        } catch (error) {
            console.error('âŒ Firebase hatasÄ±:', error);
            showStatus('Firebase baÅŸlatma hatasÄ±: ' + error.message, 'error');
        }

        function showStatus(message, type) {
            const statusDiv = document.getElementById('status');
            statusDiv.textContent = message;
            statusDiv.className = `status ${type}`;
            statusDiv.style.display = 'block';
        }

        function log(message) {
            const logDiv = document.getElementById('log');
            logDiv.textContent += new Date().toLocaleTimeString() + ' - ' + message + '\n';
            console.log(message);
        }

        async function testFirebaseConnection() {
            log('ğŸ”Œ Firebase baÄŸlantÄ± testi baÅŸlatÄ±lÄ±yor...');
            
            try {
                if (!app || !db) {
                    throw new Error('Firebase henÃ¼z initialize edilmedi');
                }
                
                showStatus('Firebase baÄŸlantÄ±sÄ± baÅŸarÄ±lÄ±!', 'success');
                log('âœ… Firebase app ve db objeleri mevcut');
                log('âœ… Project ID: ' + firebaseConfig.projectId);
                log('âœ… API Key: ' + firebaseConfig.apiKey.substring(0, 10) + '...');
                
            } catch (error) {
                showStatus('Firebase baÄŸlantÄ± hatasÄ±: ' + error.message, 'error');
                log('âŒ Firebase baÄŸlantÄ± hatasÄ±: ' + error.message);
            }
        }

        async function testDataRead() {
            log('ğŸ“Š Veri okuma testi baÅŸlatÄ±lÄ±yor...');
            
            try {
                // Exams koleksiyonunu okumaya Ã§alÄ±ÅŸ
                log('ğŸ“‹ Exams koleksiyonu okunuyor...');
                const examsSnapshot = await db.collection('exams').limit(1).get();
                log('âœ… Exams koleksiyonu baÅŸarÄ±yla okundu. Document sayÄ±sÄ±: ' + examsSnapshot.size);
                
                // Results koleksiyonunu okumaya Ã§alÄ±ÅŸ
                log('ğŸ“‹ Results koleksiyonu okunuyor...');
                const resultsSnapshot = await db.collection('results').limit(1).get();
                log('âœ… Results koleksiyonu baÅŸarÄ±yla okundu. Document sayÄ±sÄ±: ' + resultsSnapshot.size);
                
                showStatus('Veri okuma testi baÅŸarÄ±lÄ±!', 'success');
                
            } catch (error) {
                showStatus('Veri okuma hatasÄ±: ' + error.message, 'error');
                log('âŒ Veri okuma hatasÄ±: ' + error.message);
                
                if (error.code === 'permission-denied') {
                    log('âš ï¸ Ä°zin hatasÄ±: Firestore kurallarÄ± bu iÅŸlemi engelliyor olabilir');
                } else if (error.code === 'unavailable') {
                    log('âš ï¸ Servis kullanÄ±lamÄ±yor: Ä°nternet baÄŸlantÄ±sÄ±nÄ± kontrol edin');
                }
            }
        }

        async function testDelete() {
            log('ğŸ—‘ï¸ Test silme iÅŸlemi baÅŸlatÄ±lÄ±yor...');
            
            try {
                // Ã–nce mevcut verileri say
                log('ğŸ“Š Mevcut result sayÄ±sÄ± kontrol ediliyor...');
                const resultsSnapshot = await db.collection('results').limit(5).get();
                log(`ğŸ“‹ ${resultsSnapshot.size} adet result bulundu (ilk 5)`);
                
                if (resultsSnapshot.size === 0) {
                    log('â„¹ï¸ Silinecek test verisi bulunamadÄ±');
                    showStatus('Test verisi bulunamadÄ±', 'info');
                    return;
                }
                
                // Ä°lk document'Ä± silmeyi dene (TEST AMACLI)
                const firstDoc = resultsSnapshot.docs[0];
                log(`ğŸ—‘ï¸ Test: ${firstDoc.id} silinmeye Ã§alÄ±ÅŸÄ±lÄ±yor...`);
                
                // SÄ°LME Ä°ÅLEMÄ°NÄ° GERÃ‡EKLEÅTÄ°RME - SADECE TEST
                // await db.collection('results').doc(firstDoc.id).delete();
                // log('âœ… Test silme iÅŸlemi tamamlandÄ±');
                
                showStatus('Test silme hazÄ±r! (GerÃ§ek silme yapÄ±lmadÄ±)', 'info');
                log('â„¹ï¸ Bu sadece testti. GerÃ§ek silme iÅŸlemi yapÄ±lmadÄ±.');
                
            } catch (error) {
                showStatus('Test silme hatasÄ±: ' + error.message, 'error');
                log('âŒ Test silme hatasÄ±: ' + error.message);
            }
        }

        // Sayfa yÃ¼klendiÄŸinde otomatik test
        window.addEventListener('load', function() {
            log('ğŸš€ Sayfa yÃ¼klendi, otomatik test baÅŸlatÄ±lÄ±yor...');
            setTimeout(testFirebaseConnection, 1000);
        });
    </script>
</body>
</html>