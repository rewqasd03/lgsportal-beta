<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ã–ÄŸrenci GiriÅŸ Sistemi Test</title>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            max-width: 800px; 
            margin: 50px auto; 
            padding: 20px;
            background: #f5f5f5;
        }
        .container { 
            background: white; 
            padding: 30px; 
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .form-group { margin: 15px 0; }
        label { 
            display: block; 
            margin-bottom: 5px; 
            font-weight: bold;
            color: #333;
        }
        select, input { 
            width: 100%; 
            padding: 12px; 
            border: 1px solid #ddd; 
            border-radius: 5px; 
            font-size: 16px;
        }
        button { 
            background: #2196F3; 
            color: white; 
            padding: 15px 30px; 
            border: none; 
            border-radius: 5px; 
            cursor: pointer; 
            font-size: 16px;
            margin: 10px 5px 10px 0;
        }
        button:hover { background: #1976D2; }
        .success { 
            background: #d4edda; 
            color: #155724; 
            padding: 15px; 
            border-radius: 5px; 
            margin: 10px 0;
        }
        .error { 
            background: #f8d7da; 
            color: #721c24; 
            padding: 15px; 
            border-radius: 5px; 
            margin: 10px 0;
        }
        .info { 
            background: #d1ecf1; 
            color: #0c5460; 
            padding: 15px; 
            border-radius: 5px; 
            margin: 10px 0;
        }
        h1, h2 { color: #333; }
        .student-info { 
            background: #e8f5e8; 
            padding: 20px; 
            border-radius: 5px; 
            margin: 15px 0;
            border-left: 4px solid #4CAF50;
        }
        .link-button {
            background: #4CAF50;
            text-decoration: none;
            display: inline-block;
            margin: 5px;
        }
        .link-button:hover {
            background: #45a049;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“ Ã–ÄŸrenci GiriÅŸ Sistemi Test</h1>
        
        <div class="info">
            <strong>Bu sayfa Ã¶ÄŸrenci giriÅŸ sistemini test eder.</strong><br>
            Firebase Firestore'daki test verilerini kullanarak giriÅŸ yapabilirsiniz.
        </div>

        <div class="form-group">
            <label for="studentClass">SÄ±nÄ±f:</label>
            <select id="studentClass">
                <option value="">SÄ±nÄ±f SeÃ§in</option>
                <option value="8-A">8-A</option>
                <option value="8-B">8-B</option>
                <option value="8-C">8-C</option>
                <option value="8-D">8-D</option>
            </select>
        </div>

        <div class="form-group">
            <label for="schoolNumber">Okul NumarasÄ±:</label>
            <input type="text" id="schoolNumber" placeholder="Okul numaranÄ±zÄ± girin">
        </div>

        <button onclick="authenticateStudent()">ğŸ” GiriÅŸ Yap</button>
        <button onclick="clearMessages()">ğŸ—‘ï¸ Temizle</button>
        <button onclick="loadAllStudents()">ğŸ“‹ TÃ¼m Ã–ÄŸrencileri Listele</button>

        <div id="result"></div>
    </div>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBYfBhkLIfjqpnL9MxBhxW6iJeC0VAEDLk",
            authDomain: "kopruler-basari-portali.firebaseapp.com",
            projectId: "kopruler-basari-portali",
            storageBucket: "kopruler-basari-portali.firebasestorage.app",
            messagingSenderId: "318334276429",
            appId: "1:318334276429:web:7caa5e5b9dccb564d71d04",
            measurementId: "G-EF6P77SMFP"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        function showMessage(message, type = 'success') {
            const resultDiv = document.getElementById('result');
            const messageClass = type === 'error' ? 'error' : type === 'info' ? 'info' : 'success';
            resultDiv.innerHTML += `<div class="${messageClass}">${message}</div>`;
        }

        function clearMessages() {
            document.getElementById('result').innerHTML = '';
        }

        async function authenticateStudent() {
            const studentClass = document.getElementById('studentClass').value;
            const schoolNumber = document.getElementById('schoolNumber').value;

            if (!studentClass || !schoolNumber) {
                showMessage('âŒ LÃ¼tfen sÄ±nÄ±f ve okul numarasÄ± girin!', 'error');
                return;
            }

            try {
                showMessage(`ğŸ” ${studentClass} sÄ±nÄ±fÄ±nda ${schoolNumber} numaralÄ± Ã¶ÄŸrenci aranÄ±yor...`, 'info');

                // Firestore'da Ã¶ÄŸrenci ara
                const studentsQuery = db.collection('students')
                    .where('class', '==', studentClass)
                    .where('number', '==', schoolNumber);

                const studentSnap = await studentsQuery.get();

                if (!studentSnap.empty) {
                    const studentDoc = studentSnap.docs[0];
                    const studentData = studentDoc.data();
                    
                    showMessage('âœ… GiriÅŸ baÅŸarÄ±lÄ±!', 'success');
                    showMessage(`ğŸ‘¤ Ã–ÄŸrenci: ${studentData.name}`, 'success');
                    showMessage(`ğŸ« SÄ±nÄ±f: ${studentData.class}`, 'success');
                    showMessage(`ğŸ“š Okul NumarasÄ±: ${studentData.number}`, 'success');
                    showMessage(`ğŸ‘ï¸ GÃ¶rÃ¼ntÃ¼lenme SayÄ±sÄ±: ${studentData.viewCount}`, 'success');

                    // Dashboard linki oluÅŸtur
                    const dashboardUrl = `/student-dashboard?studentId=${studentData.id}`;
                    showMessage(`ğŸ”— Dashboard: <a href="${dashboardUrl}" target="_blank">${dashboardUrl}</a>`, 'info');

                    // Ã–rnek dashboard linki
                    showMessage('ğŸ“Œ <strong>Student Dashboard Test URL:</strong>', 'info');
                    showMessage('https://basari-takip-oytcy4mm8-rewqasd03s-projects.vercel.app/student-dashboard?studentId=' + studentData.id, 'info');

                } else {
                    showMessage('âŒ Bu sÄ±nÄ±f ve okul numarasÄ±nda Ã¶ÄŸrenci bulunamadÄ±!', 'error');
                    showMessage('ğŸ“‹ Mevcut test verilerini kontrol edin.', 'info');
                }

            } catch (error) {
                console.error('Hata:', error);
                showMessage(`âŒ Hata oluÅŸtu: ${error.message}`, 'error');
            }
        }

        async function loadAllStudents() {
            try {
                showMessage('ğŸ“‹ TÃ¼m Ã¶ÄŸrenciler yÃ¼kleniyor...', 'info');

                const studentsSnapshot = await db.collection('students').get();
                
                if (studentsSnapshot.empty) {
                    showMessage('âŒ HiÃ§ Ã¶ÄŸrenci bulunamadÄ±! Firebase test verilerini ekleyin.', 'error');
                    return;
                }

                showMessage(`âœ… ${studentsSnapshot.size} Ã¶ÄŸrenci bulundu:`, 'success');

                studentsSnapshot.forEach((doc) => {
                    const student = doc.data();
                    showMessage(`ğŸ‘¤ ${student.name} - ${student.class}/${student.number}`, 'info');
                });

            } catch (error) {
                console.error('Hata:', error);
                showMessage(`âŒ Hata oluÅŸtu: ${error.message}`, 'error');
            }
        }
    </script>
</body>
</html>