"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[621],{34621:function(t,e,a){a.d(e,{AW:function(){return P},FP:function(){return C},Gc:function(){return f},I8:function(){return l},JU:function(){return n.doc},M3:function(){return A},MA:function(){return p},MV:function(){return O},O7:function(){return h},Oh:function(){return b},QT:function(){return n.QT},Sh:function(){return y},ZH:function(){return k},_P:function(){return D},addBulkOkumaSinavlari:function(){return q},addKitapSinavi:function(){return x},bK:function(){return w},cW:function(){return I},db:function(){return i},deleteKitapSinavi:function(){return F},deleteOdev:function(){return j},deleteOkumaSinavi:function(){return Q},f6:function(){return g},getKitapSinavlari:function(){return K},getOdevDurumlari:function(){return N},getOdevDurumlariTumKayitlar:function(){return M},getOkumaSinavlariByClassAndDate:function(){return z},qb:function(){return B},rO:function(){return E},rd:function(){return v},sK:function(){return d},tS:function(){return s},updateKitapSinavi:function(){return T},updateOdevDurumu:function(){return _},w0:function(){return S},z3:function(){return u}});var r=a(738),n=a(5978),o=a(43301);let c=(0,r.ZF)({apiKey:"AIzaSyBYfBhkLIfjqpnL9MxBhxW6iJeC0VAEDLk",authDomain:"kopruler-basari-portali.firebaseapp.com",projectId:"kopruler-basari-portali",storageBucket:"kopruler-basari-portali.firebasestorage.app",messagingSenderId:"318334276429",appId:"1:318334276429:web:7caa5e5b9dccb564d71d04",measurementId:"G-EF6P77SMFP"}),i=(0,n.getFirestore)(c),l=(0,o.v0)(c),u=async(t,e,a)=>{try{if(a&&""!==a.trim()){let r=(0,n.query)((0,n.collection)(i,"students"),(0,n.where)("pin","==",a)),o=await (0,n.getDocs)(r);if(!o.empty){let a=o.docs[0],r=a.data();if(r.class===t&&r.number===e)return{id:a.id,...r}}}else{let a=(0,n.query)((0,n.collection)(i,"students"),(0,n.where)("class","==",t),(0,n.where)("number","==",e)),r=await (0,n.getDocs)(a);if(!r.empty){let t=r.docs[0],e=t.data();if(!e.pin){console.log("⚠️ ".concat(e.name," \xf6ğrencisinin PIN'i yok, otomatik atanıyor..."));let a=m();await f(t.id,{pin:a}),console.log("✅ ".concat(e.name," i\xe7in PIN oluşturuldu: ").concat(a))}return{id:t.id,...e}}}return null}catch(t){return console.error("Authentication error:",t),null}},s=async t=>{try{let e;let a=!1,r=0,o=(await d()).map(t=>t.pin).filter(Boolean);do if(e=m(),a=!o.includes(e),++r>100)throw Error("Benzersiz PIN oluşturulamadı");while(!a);let c=await (0,n.addDoc)((0,n.collection)(i,"students"),{...t,pin:e,viewCount:0,lastViewDate:new Date().toISOString(),createdAt:new Date().toISOString()});return console.log("✅ Yeni \xf6ğrenci eklendi: ".concat(t.name," - PIN: ").concat(e)),c.id}catch(t){throw console.error("Error adding student:",t),t}},d=async()=>(await (0,n.getDocs)((0,n.collection)(i,"students"))).docs.map(t=>({id:t.id,...t.data()})),D=async()=>(await (0,n.getDocs)((0,n.collection)(i,"exams"))).docs.map(t=>({id:t.id,...t.data()})),h=async()=>(await (0,n.getDocs)((0,n.collection)(i,"results"))).docs.map(t=>({id:t.id,...t.data()})),g=async t=>(await (0,n.addDoc)((0,n.collection)(i,"results"),{...t,createdAt:new Date().toISOString()})).id,m=()=>Math.floor(1e3+9e3*Math.random()).toString(),w=async()=>{try{let t=await d(),e={updated:0,errors:[]};for(let a of t.filter(t=>!t.pin))try{let r;let n=!1,o=0;do if(r=m(),n=!t.find(t=>t.pin===r),++o>100)throw Error("Benzersiz PIN oluşturulamadı");while(!n);await f(a.id,{pin:r}),e.updated++,console.log("\uD83D\uDCDD ".concat(a.name," \xf6ğrencisine PIN atandı: ").concat(r))}catch(r){let t="".concat(a.name," i\xe7in PIN atanırken hata: ").concat(r);e.errors.push(t),console.error(t)}return console.log("✅ PIN atama işlemi tamamlandı. ".concat(e.updated," \xf6ğrenci g\xfcncellendi.")),e}catch(t){throw console.error("PIN atama işlemi hatası:",t),t}},f=async(t,e)=>{try{let a=(0,n.doc)(i,"students",t);return await (0,n.r7)(a,e),!0}catch(t){throw console.error("Error updating student:",t),t}},y=async t=>{try{let e=(0,n.doc)(i,"students",t),a=await (0,n.QT)(e);if(a.exists()){let t=a.data().viewCount||0,r=a.data().lastViewDate||"",o=new Date().toISOString().split("T")[0];if(r!==o)return await (0,n.r7)(e,{viewCount:t+1,lastViewDate:o}),t+1;return t}return 0}catch(t){return console.error("Error incrementing view count:",t),0}},p=async t=>{try{let e=(0,n.doc)(i,"students",t);return await (0,n.deleteDoc)(e),!0}catch(t){throw console.error("Error deleting student:",t),t}},v=async t=>(await (0,n.addDoc)((0,n.collection)(i,"exams"),{...t,createdAt:new Date().toISOString()})).id,S=async(t,e)=>{try{let a=(0,n.doc)(i,"exams",t);return await (0,n.r7)(a,e),!0}catch(t){throw console.error("Error updating exam:",t),t}},k=async t=>{try{let e=(0,n.doc)(i,"exams",t);return await (0,n.deleteDoc)(e),!0}catch(t){throw console.error("Error deleting exam:",t),t}},I=async(t,e)=>{try{let a=(0,n.doc)(i,"results",t);return await (0,n.r7)(a,e),!0}catch(t){throw console.error("Error updating result:",t),t}},O=async t=>{try{let e=(0,n.doc)(i,"results",t);return await (0,n.deleteDoc)(e),!0}catch(t){throw console.error("Error deleting result:",t),t}},C=t=>({...t}),A=t=>({...t}),b=async(t,e,a)=>{try{let r=C(e),o=(0,n.doc)(i,"targets",t);await (0,n.pl)(o,{studentId:t,targets:r,targetScore:a||450,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}),console.log("\uD83C\uDFAF Hedefler kaydedildi (Dashboard formatında):",t,r),console.log("\uD83C\uDFAF Puan hedefi kaydedildi:",a||450)}catch(t){throw console.error("Hedef kaydetme hatası:",t),t}},P=async t=>{try{let e=(0,n.doc)(i,"targets",t),a=await (0,n.QT)(e);if(console.log("\uD83D\uDCCB Hedef arama - \xd6ğrenci ID: ".concat(t)),console.log("\uD83D\uDCCB Doc mevcut mu:",a.exists()),a.exists()){let t=a.data(),e=t.targets||{};return console.log("\uD83D\uDCCB Bulunan net hedefleri (Dashboard formatı):",e),console.log("\uD83C\uDFAF Puan hedefi:",t.targetScore||450),console.log("\uD83D\uDD04 Panel i\xe7in d\xf6n\xfcşt\xfcr\xfclm\xfcş:",A(e)),e}return console.log("\uD83D\uDCCB Hedef bulunamadı"),null}catch(t){return console.error("Hedef getirme hatası:",t),null}},E=async t=>{try{let e=(0,n.doc)(i,"targets",t),a=await (0,n.QT)(e);if(a.exists()){let e=a.data().targetScore;return console.log("\uD83C\uDFAF Puan hedefi bulundu (".concat(t,"):"),e||450),e||450}return console.log("\uD83D\uDCCB Puan hedefi bulunamadı, varsayılan kullanılıyor: 450"),450}catch(t){return console.error("Puan hedefi getirme hatası:",t),450}},B=async()=>{try{let t=await (0,n.getDocs)((0,n.collection)(i,"targets")),e={};return t.docs.forEach(t=>{let a=t.data();a.studentId&&a.targets&&(e[a.studentId]=a.targets)}),e}catch(t){return console.error("T\xfcm hedefleri getirme hatası:",t),{}}},x=async t=>{try{let e=(0,n.collection)(i,"kitapSinavlari"),a=await (0,n.addDoc)(e,{...t,createdAt:new Date().toISOString()});return console.log("\uD83D\uDCDA Kitap sınavı eklendi:",a.id),a.id}catch(t){throw console.error("Kitap sınavı ekleme hatası:",t),t}},K=async()=>{try{let t=(0,n.collection)(i,"kitapSinavlari"),e=await (0,n.getDocs)(t),a=[];return e.forEach(t=>{a.push({id:t.id,...t.data()})}),a.sort((t,e)=>new Date(e.tarih).getTime()-new Date(t.tarih).getTime()),console.log("\uD83D\uDCDA Bulunan kitap sınavları:",a.length),a}catch(t){return console.error("Kitap sınavları getirme hatası:",t),[]}},T=async(t,e)=>{try{let a=(0,n.doc)(i,"kitapSinavlari",t);await (0,n.r7)(a,{puanlar:e,updatedAt:new Date().toISOString()}),console.log("\uD83D\uDCDA Kitap sınavı g\xfcncellendi:",t)}catch(t){throw console.error("Kitap sınavı g\xfcncelleme hatası:",t),t}},F=async t=>{try{let e=(0,n.doc)(i,"kitapSinavlari",t);await (0,n.deleteDoc)(e),console.log("\uD83D\uDCDA Kitap sınavı silindi:",t)}catch(t){throw console.error("Kitap sınavı silme hatası:",t),t}},N=async(t,e,a)=>{try{let r=(0,n.doc)(i,"odevler","".concat(t,"_").concat(e,"_").concat(a)),o=await (0,n.QT)(r);if(o.exists())return o.data().ogrenciDurumlari||{};return{}}catch(t){return console.error("\xd6dev durumları getirme hatası:",t),{}}},_=async(t,e,a,r,o)=>{try{let c="".concat(t,"_").concat(e,"_").concat(a),l=(0,n.doc)(i,"odevler",c),u=await (0,n.QT)(l),s={...u.exists()&&u.data().ogrenciDurumlari||{},[r]:o},d=Object.keys(s).length,D=Object.values(s).filter(t=>"yapildi"===t).length,h=Object.values(s).filter(t=>"eksikYapildi"===t).length,g=Object.values(s).filter(t=>"yapilmadi"===t).length,m=d>0?D/d*100:0,w={ders:t,sinif:e,tarih:a,ogrenciDurumlari:s,toplamOgrenci:d,yapildi:D,eksikYapildi:h,yapilmadi:g,yuzde:Math.round(100*m)/100,updatedAt:new Date().toISOString()};await (0,n.pl)(l,{...w,createdAt:u.exists()?u.data().createdAt:new Date().toISOString()},{merge:!0}),console.log("\uD83D\uDCDD \xd6dev durumu g\xfcncellendi: ".concat(t," - ").concat(e," - ").concat(a," - ").concat(r," = ").concat(o))}catch(t){throw console.error("\xd6dev durumu g\xfcncelleme hatası:",t),t}},M=async()=>{try{let t=(0,n.collection)(i,"odevler"),e=(0,n.query)(t,(0,n.orderBy)("tarih","desc")),a=await (0,n.getDocs)(e),r=[];return a.forEach(t=>{let e=t.data(),a=Object.entries(e.ogrenciDurumlari||{}).map(t=>{let[e,a]=t;return{ogrenciId:e,durum:a}});r.push({ders:e.ders,sinif:e.sinif,tarih:e.tarih,ogrenciler:a,toplamOgrenci:e.toplamOgrenci||0,yapildi:e.yapildi||0,eksikYapildi:e.eksikYapildi||0,yapilmadi:e.yapilmadi||0,updatedAt:e.updatedAt})}),r}catch(t){return console.error("\xd6dev ge\xe7miş kayıtları getirme hatası:",t),[]}},j=async t=>{try{let e=(0,n.doc)(i,"odevler",t);await (0,n.deleteDoc)(e),console.log("\uD83D\uDCDD \xd6dev silindi:",t)}catch(t){throw console.error("\xd6dev silme hatası:",t),t}},q=async t=>{try{let e=(0,n.qs)(i);t.forEach(t=>{let a=(0,n.doc)((0,n.collection)(i,"okumaSinavlari"));e.set(a,{class:t.classId,date:t.date,studentId:t.studentId,studentName:t.studentName,wpm:t.wpm,createdAt:new Date().toISOString()})}),await e.commit(),console.log("\uD83D\uDCDA Toplu okuma sınavı kaydedildi:",t.length,"sonu\xe7")}catch(t){throw console.error("Toplu okuma sınavı kaydetme hatası:",t),t}},z=async(t,e)=>{try{let a=(0,n.query)((0,n.collection)(i,"okumaSinavlari"),(0,n.where)("class","==",t));return(await (0,n.getDocs)(a)).docs.map(t=>({id:t.id,...t.data()})).filter(t=>t.date===e)}catch(t){throw console.error("Sınıf okuma sınavları getirme hatası:",t),t}},Q=async t=>{try{await (0,n.deleteDoc)((0,n.doc)(i,"okumaSinavlari",t)),console.log("\uD83D\uDCDA Okuma sınavı silindi:",t)}catch(t){throw console.error("Okuma sınavı silme hatası:",t),t}}}}]);